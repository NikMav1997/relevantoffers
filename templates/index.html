<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Relevant Offers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Сортировка офферов по кликам
    document.addEventListener("DOMContentLoaded", () => {
      const cardsContainer = document.getElementById("cards");
      const cards = Array.from(cardsContainer.children);

      cards.sort((a, b) => {
        const aClicks = parseInt(localStorage.getItem("clicks_" + a.dataset.title) || "0");
        const bClicks = parseInt(localStorage.getItem("clicks_" + b.dataset.title) || "0");
        return bClicks - aClicks;
      });

      cards.forEach(card => cardsContainer.appendChild(card));
    });

    // Просмотры
    function countView(title) {
      const key = "views_" + title;
      const current = parseInt(localStorage.getItem(key) || "0");
      localStorage.setItem(key, current + 1);
    }

    // Клики
    function countClick(title, url) {
      const key = "clicks_" + title;
      const current = parseInt(localStorage.getItem(key) || "0");
      localStorage.setItem(key, current + 1);
      alert(`Кликов по "${title}": ${current + 1}`);
      window.open(url, "_blank");
    }
  </script>
  <style>
    .card-img {
      max-height: 180px;
      object-fit: cover;
      width: 100%;
      transition: transform 0.3s ease;
    }
    .offer-card:hover .card-img {
      transform: scale(1.05);
    }
  </style>
</head>
<body class="text-white bg-black bg-opacity-80 min-h-screen p-4">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="cards">
      {% for offer in offers %}
        <div class="offer-card bg-gradient-to-br from-gray-100 to-white text-black rounded-2xl shadow-2xl overflow-hidden flex flex-col transform hover:-translate-y-1 transition-all duration-300" data-title="{{ offer.title }}" onload="countView('{{ offer.title }}')" onmouseenter="countView('{{ offer.title }}')">
          <img src="{{ offer.image }}" alt="offer image" class="card-img" onerror="this.style.display='none'">
          <div class="p-4 flex flex-col justify-between flex-grow">
            <div>
              <h2 class="text-lg font-bold mb-1">{{ offer.title }}</h2>
              <p class="text-sm text-gray-700 mb-2">{{ offer.subtitle }}</p>
            </div>
            <button onclick="countClick('{{ offer.title }}', '{{ offer.url }}')" class="mt-auto inline-block bg-blue-600 hover:bg-blue-800 text-white font-semibold py-2 px-4 rounded-xl text-center transition-all duration-300 shadow-lg hover:shadow-xl">
              {{ offer.button }}
            </button>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</body>
</html>